/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var crops =
    /* color: #08d600 */
    /* shown: false */
    ee.Geometry.MultiPoint(
        [[-16.627620125876504, 14.889083307317867],
         [-16.624830628501016, 14.889684686204813],
         [-16.619380379782754, 14.891571760781384],
         [-16.617298985587198, 14.89192428936468],
         [-16.623049641715127, 14.884230740417328],
         [-16.63268413649662, 14.889166256229633],
         [-16.63573112593754, 14.889767634885084],
         [-16.63317766295536, 14.89225608044557],
         [-16.63225498305424, 14.905708872927699],
         [-16.630645657645303, 14.907367717031153],
         [-16.62800636397465, 14.907844632344613],
         [-16.616183186637002, 14.909192430777505],
         [-16.470478450171065, 14.945183850307233],
         [-16.50858727585466, 14.960027322513566],
         [-16.500175868383955, 14.946676536408267],
         [-16.488760386816573, 14.961271142255674],
         [-16.462238704077315, 14.93033935158399],
         [-16.46335450302751, 14.928266015929006],
         [-16.509703074804854, 14.927104939224769],
         [-16.32478777058799, 14.917688793142355],
         [-16.319337521869727, 14.914205372853894],
         [-16.31753507741172, 14.925982423862806],
         [-16.30650583394248, 14.920259852880235],
         [-16.305647527057715, 14.922706477955552],
         [-16.306849156696387, 14.92560921735523],
         [-16.34646001942832, 14.911675710860239],
         [-16.082314560266173, 14.867208707803838],
         [-16.08587653383795, 14.871107667637414],
         [-16.08364493593756, 14.878490611311133],
         [-16.094330856652892, 14.863641512639678],
         [-16.07918174013678, 14.86521772242321],
         [-16.066607544274962, 14.868577499599331],
         [-15.833111695078554, 14.787253045012315],
         [-15.83392708661908, 14.793477055223569],
         [-15.821352890757264, 14.789659683461554],
         [-15.826846054819764, 14.796091086272988],
         [-15.806761673716249, 14.778871095925362],
         [-15.805645874766054, 14.787211551011925],
         [-15.802770546702089, 14.795427208355584],
         [-16.00811912656151, 14.628738495329387],
         [-16.00983574033104, 14.628427064050795],
         [-16.022045155766833, 14.628364777742053],
         [-16.377935017517586, 14.656958173457694],
         [-16.386147265560698, 14.66159570907575],
         [-16.384902720577788, 14.665124703728294],
         [-16.396404032833647, 14.661139011493942],
         [-16.351214175350737, 14.654329952796855],
         [-16.354985890543006, 14.802956266899356],
         [-16.36584347263529, 14.800466793036584],
         [-16.32687634006693, 14.803786085168388],
         [-16.478358898846217, 14.710000967806264],
         [-16.481470261303492, 14.711972623436031],
         [-16.480204258648463, 14.711827344155468],
         [-16.477929745403834, 14.712927313444935],
         [-16.478852425304957, 14.713840491283968],
         [-16.485954914776393, 14.712761280699958],
         [-16.470639499530954, 14.70896843563334],
         [-16.470907720432443, 14.708610420874889],
         [-16.475590857372445, 14.708153821490319],
         [-16.47547284017579, 14.708667495730804],
         [-16.47349005149319, 14.707000024579704],
         [-16.473817280993007, 14.707064882847869],
         [-16.559138704543418, 14.740866532645521],
         [-16.560254503493613, 14.746095829025169],
         [-16.52686636567623, 14.748170911823962],
         [-16.53261702180416, 14.752072013925854],
         [-16.532531191115684, 14.756388045393122],
         [-16.561386926682154, 14.750702126397547],
         [-16.56348977854983, 14.751241638409784],
         [-16.557159765274683, 14.754146680097199],
         [-16.53553717898143, 14.833553592112297],
         [-16.53599851893199, 14.833875101642777],
         [-16.390165755166493, 15.005173387904028],
         [-16.405057379617176, 15.00459305860853],
         [-16.38673252762743, 15.002769156280362],
         [-16.407331892861805, 15.004012727737532],
         [-16.408876845254383, 15.002603346206197],
         [-16.41316837967821, 15.000116179662635],
         [-16.418017813577137, 14.994519949171014],
         [-16.33135841370133, 14.999774590356054],
         [-16.329277019505774, 15.000158031030391],
         [-16.13111714505304, 14.766074738376094],
         [-16.122104922763, 14.772423846106728],
         [-16.135206830900014, 14.727471994394543],
         [-16.126623762052358, 14.72572876052939],
         [-16.125121725004018, 14.726475862464326],
         [-16.119928968351186, 14.729381234536286],
         [-16.114264142911733, 14.733033647332984],
         [-15.476830364087256, 14.748362202797063],
         [-15.485241771557959, 14.757575323367861],
         [-15.482581020215186, 14.758156317893244],
         [-15.479576946118506, 14.761144265221919],
         [-15.455716014722022, 14.770356844333461],
         [-15.449793697217139, 14.776332362519618],
         [-15.481293559888037, 14.725037154703077],
         [-15.46747481904331, 14.733255161218265],
         [-15.513050914624365, 14.74744916960519],
         [-15.499146343091162, 14.745872103253054],
         [-15.502236247876318, 14.723957999520145],
         [-15.50644195161167, 14.726946416171392],
         [-15.536053539136084, 14.725369201376994],
         [-15.53940093598667, 14.727942545951237],
         [-15.49820220551792, 14.7659580940027],
         [-15.513760565278986, 14.771024604406684],
         [-15.511958120820978, 14.770920861639],
         [-15.510713575838068, 14.759488105246445],
         [-15.510799406526544, 14.760670832063424],
         [-15.501851557252863, 14.76025584093035],
         [-15.517816065309503, 14.771232089793454],
         [-15.526613710878351, 14.763596497077918],
         [-15.580463166044046, 14.745517761420409],
         [-15.602435822294046, 14.751825968536163],
         [-17.196285888582953, 14.756914939629981],
         [-17.19336764517475, 14.760317895819998],
         [-17.189934417635687, 14.761521367580656],
         [-17.185814544588812, 14.766418183981216],
         [-17.176201507479437, 14.758865421032365],
         [-17.17465655508686, 14.761687363162872],
         [-17.16633979094231, 14.767914447709195],
         [-17.167133724810718, 14.771607710830336],
         [-17.16831389677727, 14.773060100479649],
         [-17.166146671893237, 14.766441274684887],
         [-17.171189224841235, 14.770487289324896],
         [-17.17119128047528, 14.7704868980797],
         [-17.139543752128354, 14.78717366795231],
         [-17.153448323661557, 14.783024227134193],
         [-17.155207852775327, 14.778999193769424],
         [-17.147053937370053, 14.782982732325497],
         [-17.143191556388608, 14.784352056825231],
         [-17.132352328607773, 14.766940051838636],
         [-17.128232455560898, 14.765736610072162],
         [-17.12591502697203, 14.765031141111535],
         [-17.084114361189947, 14.786296396747524],
         [-17.08847941735665, 14.783350551223316],
         [-17.09768475869576, 14.782520654789888],
         [-17.09721268990914, 14.787292515958715],
         [-17.065717113242833, 14.787078704770188],
         [-17.064150703178136, 14.788219787588748],
         [-17.0620907666547, 14.78697496967104],
         [-17.072218787894933, 14.78514922381137],
         [-17.202873719680607, 14.834408014563065],
         [-17.202905906188786, 14.835258454729011],
         [-17.151366976348378, 14.832170610298368],
         [-17.15278318270824, 14.832118753546261],
         [-17.15476801737926, 14.833021059259641],
         [-17.154853848067738, 14.833674450702947],
         [-17.151721027938343, 14.834369325151977],
         [-17.151120213119007, 14.834742689605745],
         [-17.089357464590012, 14.871182518718669],
         [-17.090784399785935, 14.87304901646012],
         [-17.09195384291643, 14.873754133626756],
         [-15.986888479349803, 15.949056210698766],
         [-15.983369421122264, 15.947570723589813],
         [-15.991008352396678, 15.954420378060789],
         [-15.991609167216014, 15.95210967741211],
         [-15.970323156473826, 15.955080573353042],
         [-15.928094457743358, 15.968531578727426],
         [-14.94674093128094, 16.58003241235587],
         [-14.95648271442303, 16.57410945528484],
         [-14.962576693304866, 16.58081390002429],
         [-14.955281084784358, 16.588176180667247],
         [-14.939402407416194, 16.584721290757837],
         [-14.93875867725262, 16.593070501806544],
         [-14.964937037237972, 16.59426321665194],
         [-14.969013994940608, 16.597142153034838],
         [-14.966009920843929, 16.574520777636952],
         [-14.972361391791194, 16.575014363299395],
         [-14.967683619269222, 16.565965091768582],
         [-14.921592539557308, 16.589739086668867],
         [-14.938114947089046, 16.578757346715417],
         [-14.933351343878597, 16.571641502717327],
         [-14.89998745092639, 16.626853604110494],
         [-14.898356667845336, 16.62479754347454],
         [-14.900588265745727, 16.62220687570677],
         [-14.914621583311645, 16.618423615511126],
         [-14.89625381597766, 16.613036453304694],
         [-14.887928239195434, 16.610116630480615],
         [-14.872092477171508, 16.61969841803727],
         [-14.871448747007934, 16.624879786322975],
         [-14.889344445555297, 16.62109657881503],
         [-14.888314477293578, 16.624262964100527],
         [-14.904150239317504, 16.61209060006766],
         [-14.900888673155395, 16.616655327024162],
         [-14.916767350523559, 16.61587398506267],
         [-14.863125628704088, 16.574902329255647],
         [-14.822441882366197, 16.535987423588676],
         [-14.818836993450182, 16.53771531329176],
         [-14.300689029381248, 16.422038962219762],
         [-14.295796680138084, 16.42467348040888],
         [-14.297684955284568, 16.435458166879126],
         [-14.28592615096328, 16.43093031798366],
         [-14.293479251549217, 16.418581102913876],
         [-14.299058246300193, 16.418828094903773],
         [-14.447498924338543, 16.51773626633071],
         [-14.444795257651531, 16.516707655993915],
         [-14.451661712729656, 16.513745227630395],
         [-14.457455284201824, 16.515720184918923],
         [-14.435911781394207, 16.515226447489052],
         [-14.456511146628582, 16.520081477421694],
         [-14.441635428226897, 16.520493410139323],
         [-14.443105278767058, 16.52139856978731],
         [-15.692277595915817, 16.374768776318742],
         [-15.679574654021286, 16.390743874742558],
         [-15.696225807585739, 16.370651270719595],
         [-12.882560253231627, 15.279222363376304],
         [-12.886465549557311, 15.280298719469787],
         [-12.88599348077069, 15.273012508832572],
         [-12.883633136837584, 15.274792685929308],
         [-12.889770031063659, 15.27379910057499],
         [-12.909593465382114, 15.275680900994459],
         [-12.904615285450474, 15.272161946584573],
         [-12.90246951823856, 15.272203346391297],
         [-14.521935970297053, 14.626230427067908],
         [-12.991418584988685, 14.7586537213295],
         [-12.989315733121009, 14.756412739019318],
         [-12.997812971280188, 14.759691205320436],
         [-12.994723066495032, 14.762388640532976],
         [-12.992706045315833, 14.762845126258403],
         [-14.871724555418243, 15.608845468101935],
         [-14.873226592466583, 15.608969466077212],
         [-14.877990195677032, 15.607192154601202],
         [-16.71340502367953, 14.144482240567907],
         [-16.46546460272061, 14.341576946475973],
         [-16.456023226988187, 14.340495917408832],
         [-12.913467182536799, 15.272881416171137],
         [-12.910591854472834, 15.270521621777592],
         [-15.633392721658709, 13.73923409102723],
         [-15.631332785135271, 13.743736286456924],
         [-15.622921377664568, 13.73273076714941],
         [-15.626955420022966, 13.724809808523176],
         [-15.666351706033709, 13.737983465833592]]),
    noncrops =
    /* color: #ff0000 */
    /* shown: false */
    ee.Geometry.MultiPoint(
        [[-16.4863220978991, 14.883628390039153],
         [-16.481043510557793, 14.880372537643607],
         [-16.549647913044378, 14.91489736511208],
         [-16.54863940245478, 14.91409907591886],
         [-16.55082808501093, 14.91619328281871],
         [-16.524683658967554, 14.916772742073734],
         [-16.524361793885767, 14.91752436874101],
         [-16.446303673083865, 14.819709663295342],
         [-16.44516641646155, 14.819263669147478],
         [-16.4917082374091, 14.841343604531309],
         [-16.492373425244793, 14.844392630378438],
         [-16.21995337693036, 14.751600217804704],
         [-16.220012385528687, 14.750215124056922],
         [-16.24752964230324, 14.771760822277514],
         [-15.878833401942979, 14.869383416109114],
         [-15.89702950790001, 14.850800359091684],
         [-15.874713528896104, 14.857188465309825],
         [-15.904972752762733, 14.852209642116904],
         [-15.906270941925941, 14.851753344563996],
         [-15.944723585310484, 14.86004614048787],
         [-15.543071187329197, 14.797128536221203],
         [-15.53950401733197, 14.799365535609024],
         [-15.541113342740905, 14.802601862493493],
         [-15.547014202573669, 14.803369445757268],
         [-15.522857566516388, 14.669842770314888],
         [-15.874764359708603, 14.658505749398765],
         [-16.23017584545245, 14.645436694349792],
         [-16.228759639092587, 14.64614254988221],
         [-16.225026004143857, 14.64832238350352],
         [-16.227815563787775, 14.639380280281301],
         [-16.229381973852472, 14.637252260938524],
         [-16.225102730224624, 14.661678308847607],
         [-16.22591275734712, 14.6602563160522],
         [-16.2359629239487, 14.659048496023845],
         [-16.23602193254703, 14.660268095674146],
         [-15.986610957300542, 14.792961646100919],
         [-15.969258132419139, 14.800998006862947],
         [-15.964918337112382, 14.803352596254076],
         [-15.96122761750789, 14.807522393310363],
         [-15.985022431474881, 14.807480299511566],
         [-15.983944183450895, 14.807036873326073],
         [-16.009360140824104, 14.806072734944825],
         [-16.009161657357, 14.80617905405952],
         [-16.01587826895882, 14.804737280799516],
         [-16.024325743968937, 14.80167365395369],
         [-15.922211451354517, 14.772903089965629],
         [-15.920763058486475, 14.771346956702542],
         [-15.895796850080634, 14.78058807973425],
         [-15.897599294538642, 14.781272750614633],
         [-15.907278600173864, 14.800654361433525],
         [-16.015981336835495, 14.837628970305317],
         [-16.015026470426193, 14.838396429417692],
         [-16.0108851397072, 14.836280724729795],
         [-16.011979480985275, 14.837006704160924],
         [-16.01988663316118, 14.835160637399152],
         [-15.917369053140385, 14.867637743112326],
         [-15.918624326959355, 14.867954017116643],
         [-15.919434354081853, 14.866600775912849],
         [-15.918683335557683, 14.867139999478344],
         [-15.91751925684522, 14.867254065829185],
         [-15.92453168001386, 14.865763976839668],
         [-15.933259269996496, 14.866555900528317],
         [-16.438459717599603, 14.643081010773658],
         [-16.438297443954202, 14.643371660567164],
         [-16.508082716231456, 14.6580389319216],
         [-16.467537474134062, 14.808327330627064],
         [-16.46785933921585, 14.811687991718934],
         [-16.464447569348906, 14.810650756201756],
         [-16.477429460980986, 14.813119368578642],
         [-16.447329538254497, 14.690231142277927],
         [-16.43991442966775, 14.691913535526208],
         [-15.865134478692818, 14.879272725145551],
         [-15.880505920471272, 14.878250921831045],
         [-15.880452276290974, 14.876892560609393],
         [-15.881224752487263, 14.878085015575609],
         [-15.851641200557935, 14.876171041073711],
         [-15.851077936664808, 14.874807482102122],
         [-15.850992105976331, 14.874371970956677],
         [-15.850648783222425, 14.874382340279876],
         [-15.848438642994154, 14.87492154439969],
         [-15.847478412166822, 14.8759169946183],
         [-15.847164717492346, 14.878300129145963],
         [-15.845158804170559, 14.878378733163096],
         [-15.843834304051677, 14.878342253628269],
         [-15.843836986260692, 14.878808864089823],
         [-15.844253392644047, 14.879425522883489],
         [-15.844245346017003, 14.879606981715897],
         [-15.846141083424895, 14.883255577190079],
         [-15.845840676015227, 14.88362367269489],
         [-15.84449420708975, 14.882913403340243],
         [-15.844467384999602, 14.883250392741855],
         [-15.847804053014128, 14.883136334849521],
         [-15.846806271260588, 14.881720975074312],
         [-15.847385628407805, 14.881772819918664],
         [-15.841431691752005, 14.884055446681609],
         [-15.84079869042449, 14.885569294610645],
         [-15.841506793604422, 14.886398795816328],
         [-15.850652125198081, 14.889259478264155],
         [-15.850662338013533, 14.890289962735721],
         [-15.851536738152388, 14.88990632575167],
         [-15.8532318942498, 14.890212198537387],
         [-17.004097713674156, 14.798293889658218],
         [-17.002938999379722, 14.799040742301468],
         [-17.005556835378258, 14.8041026757518],
         [-17.003110660756676, 14.811404928876746],
         [-17.009472080332102, 14.805533616764428],
         [-17.007229753595652, 14.80683019099875],
         [-17.027346746215198, 14.803275208739517],
         [-17.030951635131213, 14.802798062498551],
         [-16.96115468251568, 14.825463261638438],
         [-16.960232002614557, 14.826687115312202],
         [-16.966717584012567, 14.822128743852149],
         [-16.950478705647892, 14.803945447185171],
         [-16.94906249928803, 14.804775261668008],
         [-17.18928861917078, 14.838046908673673],
         [-17.190189841399786, 14.838223216748393],
         [-17.190028908858892, 14.840131483183598],
         [-17.194254596005347, 14.838538913635452],
         [-17.194506723652747, 14.838886343325424],
         [-16.946104519307735, 14.42067933896673],
         [-16.947070114553096, 14.419484393041321],
         [-16.944355719030025, 14.41906875817393],
         [-16.943390123784663, 14.42259123911789],
         [-16.946104519307735, 14.422279517386565],
         [-16.94473122829211, 14.422419792219639],
         [-16.942177765309932, 14.420897545791595],
         [-16.942370884359004, 14.421328763412323],
         [-16.940058820188167, 14.422232759089262],
         [-16.945432126870266, 14.411985357392714],
         [-16.946762502541652, 14.409397930695885],
         [-16.935658157219997, 14.412026922235176],
         [-16.935711801400295, 14.41329464620784],
         [-15.443700648401567, 15.586152118426806],
         [-15.448700286005327, 15.592993317900474],
         [-15.43262848958809, 15.591670565987615],
         [-15.427757598017045, 15.593324004547135],
         [-15.987896151819688, 15.800116867177989],
         [-15.988942213335497, 15.799688442589103],
         [-15.99008483437584, 15.80035430692116],
         [-15.990937776842577, 15.799327119942046],
         [-15.986399479189378, 15.800725951177574],
         [-16.065990533744795, 15.790990802182879],
         [-16.089765634452803, 15.779923238090865],
         [-16.0978337191696, 15.785374501904354],
         [-16.10461434355925, 15.793633713152493],
         [-16.104271020805342, 15.80131447740888],
         [-16.03689393035124, 15.79668953597585],
         [-15.754243686069973, 15.39927316414392],
         [-15.753127887119778, 15.392901373442797],
         [-15.812608554234036, 15.399438662600963],
         [-15.813896014561184, 15.390253299138019],
         [-15.822135760654934, 15.403824323731653],
         [-15.866610311454417, 15.379305131602242],
         [-15.863520406669261, 15.367636039712648],
         [-15.935618184989574, 15.365898033957816],
         [-15.93544652361262, 15.3757465416279],
         [-15.930640005057933, 15.362918561814972],
         [-15.264916915127001, 15.144922130101909],
         [-15.301051634975634, 15.148401785733695],
         [-15.327144164272509, 15.157017829619303],
         [-15.317960280605517, 15.127771563349429],
         [-15.292811888881884, 15.128600125061965],
         [-15.265775222011767, 15.131997194214003],
         [-15.250497359462939, 15.161574249418376],
         [-15.258565444179736, 15.161739935561132],
         [-15.406510589513656, 14.931650025689109],
         [-15.420801399145004, 14.933225737795068],
         [-15.39891457358348, 14.945872482009346],
         [-15.414707420263168, 14.948857834251728],
         [-15.409981226571142, 14.963579615722526],
         [-15.399252390511572, 14.9279209740783],
         [-15.368525004036963, 14.959433566494976],
         [-15.364061808236182, 14.964823414855928],
         [-15.442081904061377, 14.931984699666252],
         [-14.815600318601902, 15.830954736627165],
         [-14.802983207395847, 15.822738337719613],
         [-14.844310683897312, 15.824967946321978],
         [-14.831307334593113, 15.829592241318313],
         [-15.248864310820087, 15.882077200986933],
         [-15.237920898039325, 15.8945837844432],
         [-15.23607553823708, 15.879765668155805],
         [-15.248091834623798, 15.88603976696597],
         [-15.194190162260517, 15.88682401557112],
         [-15.241617772380478, 15.892087893514395],
         [-15.243098351756698, 15.890540071967278],
         [-15.244181964198715, 15.89113856437705],
         [-15.23979387025035, 15.892676062580962],
         [-15.042427603929047, 15.112394092175554],
         [-15.008095328538422, 15.111606898466537],
         [-15.04684788438559, 15.117904366351157],
         [-15.028823439805512, 15.122295910923382],
         [-15.0261197731185, 15.126728792910248],
         [-15.022214476792817, 15.12768164328841],
         [-15.039466445176606, 15.126728792910248],
         [-15.039337699143891, 15.120431587073016],
         [-15.047319953172211, 15.126977362987093],
         [-15.064014022080903, 15.107256564779535],
         [-15.009125296800141, 15.121467324569192],
         [-16.059961165044104, 15.122734292629273],
         [-16.05309470996598, 15.129445708861907],
         [-16.005802000615393, 15.138228228773254],
         [-16.014814222905432, 15.144607755452151],
         [-15.90380437290449, 15.925452169798296],
         [-15.853335928080272, 15.876914868879656],
         [-15.96697575962324, 15.94889115711905],
         [-15.946719717142772, 15.97397774112331],
         [-15.926120351908397, 16.014901732256853],
         [-15.964143346903514, 15.932797780807135],
         [-15.716009192333335, 16.30647808884061],
         [-15.719935946331137, 16.30672522275908],
         [-15.719549708232993, 16.30944367527956],
         [-15.702834181652182, 16.309567240406572],
         [-15.708477549419516, 16.313768408327487],
         [-15.028524222921261, 16.513545135182405],
         [-15.02079946095837, 16.51749503366445],
         [-14.92247509130725, 16.62368726157076],
         [-14.918655625670043, 16.622289119665446],
         [-14.884623757689086, 16.63474867218558],
         [-14.912347070067016, 16.61188497918231],
         [-14.881877175657836, 16.638983913306234],
         [-14.886383286802856, 16.638038187964646],
         [-14.889859429686156, 16.635159864744043],
         [-14.885138741819945, 16.651565728196072],
         [-14.815489596599596, 16.56075236362481],
         [-14.819180316204088, 16.565523979836225],
         [-14.868618792766588, 16.570295477846113],
         [-14.873167819255846, 16.54150016047826],
         [-14.85359842228319, 16.528582006788888],
         [-14.845787829631822, 16.526689465809472],
         [-14.831282443279283, 16.528499722784215],
         [-13.784821538831418, 16.11195828532424],
         [-13.789198903943722, 16.105691274463993],
         [-13.792975454236691, 16.122677713268892],
         [-13.751605062390988, 16.112782877277255],
         [-13.734181432630246, 16.094888462205578],
         [-13.84395888319177, 16.074600677302186],
         [-13.836319951917355, 16.06561071222824],
         [-14.572663439786288, 16.19241474912051],
         [-14.573049677884432, 16.191095931311388],
         [-14.577040804898592, 16.192455962035005],
         [-14.571826590573641, 16.193589313810374],
         [-14.569981230771395, 16.195052358293516],
         [-14.56961645034537, 16.192785665041114],
         [-14.440702019489715, 16.522951731572505],
         [-14.443437872684905, 16.52387745119937],
         [-14.443180380619475, 16.523908308443854],
         [-14.445122299946258, 16.523939165683394],
         [-16.012349085367134, 16.49384845984361],
         [-16.01342196897309, 16.492202477348396],
         [-16.002263979471138, 16.49310776945331],
         [-16.00445266202729, 16.496975788010847],
         [-16.006813005960396, 16.48784055603326],
         [-16.02067466214936, 16.488498965549606],
         [-16.022562937295845, 16.48681178668078],
         [-16.002135233438423, 16.486770635792965],
         [-15.999131159341744, 16.48561840738279],
         [-15.987372355020455, 16.494136505340826],
         [-15.985312418497017, 16.493313517068334],
         [-13.7617900278025, 16.129386161362813],
         [-13.754923572724374, 16.081063334085474],
         [-13.734667530243906, 16.115863552729913],
         [-13.742220630829843, 16.12856163847036],
         [-13.816550007050546, 16.095577910858758],
         [-13.856398002455338, 16.099120440090818],
         [-13.87030257398854, 16.099697692163137],
         [-13.86781348402272, 16.102872548554412],
         [-13.871289626906021, 16.103655946865263],
         [-13.91038181889486, 16.113841716143373],
         [-13.917419935349939, 16.10975997425254],
         [-13.915488744859216, 16.10819322273559],
         [-13.946645284776208, 16.118005830899012],
         [-13.946301962022302, 16.12229354084331],
         [-13.908751035813806, 16.121881265070886],
         [-13.766265451591703, 15.254747304977471],
         [-13.766630232017729, 15.253029063296687],
         [-13.761973917167875, 15.25381572990659],
         [-13.758240282219145, 15.254209062107018],
         [-13.758905470054838, 15.248888664177384],
         [-13.770320951622221, 15.248039872282769],
         [-13.773711263817045, 15.258018135844676],
         [-13.763304292839262, 15.256382726777113],
         [-13.749228059929106, 15.253546607450444],
         [-13.809013820066928, 15.268856994732914],
         [-13.811331248655796, 15.264592703751648],
         [-13.817790007963657, 15.267842680943865],
         [-13.797555423155307, 15.268877694963287],
         [-13.796589827909946, 15.262460525779174],
         [-13.795431113615512, 15.269415900236329],
         [-13.79873559512186, 15.262978046694421],
         [-13.778749095299725, 15.280041585904762],
         [-13.780251132348065, 15.280476267140312],
         [-13.779832707741742, 15.281324927908328],
         [-13.62806631329141, 14.900996761964121],
         [-13.620427382016995, 14.909705741526864],
         [-13.587210905576566, 14.934337803246349],
         [-13.557341825986722, 14.909788682495334],
         [-13.596308958555081, 14.895771205126652],
         [-12.939397688899184, 15.255080538665958],
         [-12.938475008998061, 15.25741980525607],
         [-12.944075461421157, 15.252472122195789],
         [-12.934977408442641, 15.252865456911486],
         [-12.9574650488235, 15.260773398638023],
         [-12.940878268275405, 15.250236310877336],
         [-12.93051421264186, 15.26247087610918],
         [-12.93126523116603, 15.262284568276641],
         [-12.862175464718444, 15.280588506704955],
         [-12.856081485836608, 15.2740888967894],
         [-12.852347850887877, 15.27636585311688],
         [-12.848142147152526, 15.284148717198129],
         [-12.848871708004577, 15.28928193753074],
         [-12.869857311337096, 15.280505710392921],
         [-12.863849163143737, 15.28476967795338],
         [-12.876294612972838, 15.282037436874305],
         [-12.896078586666686, 15.281209478003388],
         [-12.902172565548522, 15.285721814206049],
         [-12.905176639645202, 15.284976664463112],
         [-12.889941692440612, 15.286715343076667],
         [-12.900885105221374, 15.289447523190502],
         [-12.904017925350768, 15.290399638195387],
         [-12.897276761585728, 15.274438923824379],
         [-14.495843441000178, 14.623988086384655],
         [-14.492925197591974, 14.623738936006305],
         [-14.490264446249201, 14.6337877769808],
         [-14.524768383016779, 14.620001646410563],
         [-14.498590023031428, 14.613523527146882],
         [-14.529145748129084, 14.637441786896213],
         [-14.51300957869549, 14.631130277004617],
         [-14.512837917318537, 14.62780835678347],
         [-14.512580425253107, 14.619752491509681],
         [-14.508910012637585, 14.610261763497618],
         [-14.501764607821912, 14.606731886261874],
         [-14.496850800906628, 14.607728563223889],
         [-14.489168954287976, 14.612649589484562],
         [-12.981419309781165, 14.751308193132903],
         [-12.982492193387122, 14.752179709445087],
         [-12.983908399746985, 14.754420735361691],
         [-12.974982008145423, 14.756869237288408],
         [-12.974080785916419, 14.759981699950991],
         [-12.95605634133634, 14.763343109593094],
         [-13.001546606228919, 14.760521188949653],
         [-13.002791151211829, 14.763960294867642],
         [-13.005451902554602, 14.764582770664951],
         [-12.916366288710206, 14.724240062798522],
         [-12.914435098219483, 14.718138592848236],
         [-12.910401055861085, 14.721210102460997],
         [-12.906195352125733, 14.719425311599647],
         [-12.905594537306397, 14.727186970130644],
         [-12.894179055739015, 14.716851866506188],
         [-12.889458367872804, 14.72112708925647],
         [-12.869202325392335, 14.716353776852168],
         [-12.868386933851808, 14.71348973927208],
         [-12.915851304579347, 14.711580359998857],
         [-12.918812463331788, 14.715399101836425],
         [-13.640186858745666, 14.488622556824184],
         [-13.635294509502502, 14.490783173448172],
         [-13.638470244976135, 14.497846580832737],
         [-13.63134629783258, 14.501585940654438],
         [-13.62662560996637, 14.507319503114719],
         [-13.62035996970758, 14.51188962773332],
         [-13.61486680564508, 14.515878023024595],
         [-13.609974456401916, 14.520198703472724],
         [-13.606455398174377, 14.526513392329196],
         [-13.600447249981018, 14.528590553199612],
         [-13.595554900737854, 14.53357565966325],
         [-13.585856032940002, 14.540720782834956],
         [-13.570320678325745, 14.547699517244979],
         [-13.615295959087463, 14.495769131440635],
         [-13.595297408672424, 14.525100911791736],
         [-13.80394513521419, 14.437064365598552],
         [-13.798924039938312, 14.435464293416418],
         [-13.796156000234943, 14.43772932727752],
         [-13.793559621908527, 14.439911218830352],
         [-13.790770124533038, 14.440139796707353],
         [-13.79347379122005, 14.436233160705891],
         [-13.797271799185138, 14.431827722953365],
         [-13.799074243643146, 14.430227613130741],
         [-13.801563333608966, 14.431890064661783],
         [-13.804567407705646, 14.430497762349187],
         [-14.157407525150164, 14.847439132840973],
         [-14.158094170657977, 14.851753266417653],
         [-14.151485207645282, 14.850674741098006],
         [-14.147365334598407, 14.852914749202707],
         [-14.145906212894305, 14.851255486169837],
         [-14.140327218143328, 14.8534954882537],
         [-14.139898064700946, 14.850674741098006],
         [-14.143502953616961, 14.844369408435131],
         [-14.139211419193133, 14.839640288239787],
         [-14.154060128299578, 14.842046344773646],
         [-14.15852332410036, 14.839557320295594],
         [-14.148652794925555, 14.863118936631453],
         [-14.852517012551926, 15.590249462739093],
         [-14.854233626321458, 15.589670752092474],
         [-14.867794875100754, 15.585165020569272],
         [-14.864490393594407, 15.589381396157568],
         [-14.849298361734055, 15.59566446189556],
         [-14.872258070901536, 15.587231882163419],
         [-14.835479620889329, 15.596945853010546],
         [-16.694865594968594, 14.15367880645577],
         [-16.6972259389017, 14.155426528022408],
         [-16.69349230395297, 14.156716504363738],
         [-16.604996624295314, 14.223989381940424],
         [-16.605897846524318, 14.229979654957733],
         [-16.617527904812892, 14.223864582897514],
         [-16.597443523709376, 14.22623575292956],
         [-16.58907503158291, 14.230187647695974],
         [-16.582466068570216, 14.229480471604758],
         [-16.584740581814845, 14.22640214989242],
         [-16.611734333340724, 14.22037018172274],
         [-12.929131283183771, 15.275448179940016],
         [-12.931706203838068, 15.275572377390409],
         [-12.929045452495295, 15.278014912305332],
         [-16.631346024184626, 13.87656265082241],
         [-16.632118500380916, 13.886394873933341],
         [-16.631174362807673, 13.891727430664378],
         [-16.640701569228572, 13.90597475345316],
         [-16.616153992324275, 13.908724135860428],
         [-16.591606415419978, 13.899975987554791],
         [-16.63598088136236, 13.86864657508135],
         [-16.699753082900447, 13.887811346284325],
         [-16.651087082534236, 13.892560631566976]]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/

//      Region        Area    Primary Crop          Notes
// --------------------------------------------------------------------
// [X]  Dakar         547                           ~20 pts each
// [ ]  Ziguinchor    7,352
// [X]  Diourbel      4,824   Millet                100 pts each
// [X]  Saint-Louis   19,241  Rice                  60 crop pts [likely rice], some noncrop too
// [ ]  Tambacounda   42,364
// [ ]  Kaolack       5,357   Millet, Peanut, Maize
// [X]  Thiès         6,670   Millet, Peanut        ~20 pts each
// [X]  Louga         24,889  Millet, Peanut        80 non-crop pts
// [ ]  Fatick        6,849   Millet, Peanut, Maize
// [ ]  Kolda         13,771
// [X]  Matam         29,445  Little everything     More non-crop pts
// [ ]  Kaffrine      11,262
// [ ]  Kédougou      16,800
// [ ]  Sédhiou       7,341


// Growing season:  June to January
var start = ee.Date('2022-05-01');
var end = ee.Date('2023-02-28');
print("https://ipad.fas.usda.gov/countrysummary/default.aspx?id=SG")

var S2display = {
  '1': 'June',
  '2': 'July',
  '3': 'August',
  '4': 'September',
  '5': 'October'
}

var country = ee.FeatureCollection("FAO/GAUL/2015/level1").filter(ee.Filter.eq('ADM0_NAME', 'Senegal'))
print(country)

var border = country
// .filter(ee.Filter.or(
//     ee.Filter.eq('ADM1_NAME', 'Dakar'),
//     ee.Filter.eq('ADM1_NAME', 'Thies'),
//     ee.Filter.eq('ADM1_NAME', 'Diourbel'),
//     ee.Filter.eq('ADM1_NAME', 'Louga'),
//     ee.Filter.eq('ADM1_NAME', 'Saint louis'),
//     ee.Filter.eq('ADM1_NAME', 'Matam'),
//     ee.Filter.eq('ADM1_NAME', 'Fatick'),
//     ee.Filter.eq('ADM1_NAME', 'Kaolack')
//     )
//   )

var aoi = border.geometry()
var area = ee.Number(aoi.area()).divide(1e6).round()
print("Area: " + area.getInfo() + " km2")

// Data Pipeline -> Dataset
var cropPts = ee.FeatureCollection(crops.coordinates().map(function(p){
  return ee.Feature(ee.Geometry.Point(p), {"is_crop": 1.0})
}))
var nonCropPts = ee.FeatureCollection(noncrops.coordinates().map(function(p){
  return ee.Feature(ee.Geometry.Point(p), {"is_crop": 0.0})
}))

var trainingPts = cropPts.merge(nonCropPts)

var imagery = require("users/izvonkov/crop-mask:utils/S2_S1_monthly")
var image = imagery.getImage(aoi, start, end)
var bands = image.bandNames()
print(bands)
var training = image.sampleRegions({
  collection: trainingPts, properties: ['is_crop'], scale: 10, geometries: true
})

Map.setOptions('SATELLITE');
Map.centerObject(aoi, 8);

var daterange = []
var d = start
while (end.difference(d, 'month').gt(0).getInfo() == 1){
  daterange.push(d.format("YY/MM"));
  d = d.advance(1, 'month');
}

// for (var i in S2display){
//   var disp = Map.addLayer(image, {bands: [i+'_B4', i+'_B3', i+'_B2'], min: 1000, max: 6000}, 'S2 ' + S2display[i]);
//   disp.setShown(0)
// }

// Additional datasets
var protectedAreas = ee.FeatureCollection('WCMC/WDPA/current/polygons')
  .filter(ee.Filter.eq('MARINE', '0'))
  .filter(ee.Filter.eq('PA_DEF', '1'))
  .filterBounds(aoi);

var paDisp = Map.addLayer(protectedAreas, {color: 'orange', opacity: 0.5}, 'All Protected Areas');
paDisp.setShown(0)

var verifiedProtectedAreas = protectedAreas.filter(ee.Filter.neq('VERIF', 'Not Reported'))
var vpaDisp = Map.addLayer(verifiedProtectedAreas, {color: 'red', opacity: 0.5}, 'Verified Protected Areas')
vpaDisp.setShown(0)

var palettes = require('users/gena/packages:palettes');
var classVis = {palette: palettes.cmocean.Speed[7].slice(0,-2)}
Map.centerObject(aoi, 7);

var glad = ee.ImageCollection("users/potapovpeter/Global_cropland_2019").filterBounds(aoi).mosaic().clip(aoi);
glad = glad.gte(0.5).rename('crop')
var gladDisp = Map.addLayer(glad.selfMask(), classVis, 'Cropland from glad');
gladDisp.setShown(0)

var worldcover_v200 = ee.ImageCollection("ESA/WorldCover/v200").filterBounds(aoi).mosaic().clip(aoi);
worldcover_v200 = worldcover_v200.eq(40).rename('crop')
var worldcoverDisp = Map.addLayer(worldcover_v200.selfMask(), classVis, 'Cropland from worldcover-v200');
worldcoverDisp.setShown(0)

var esri_lulc = ee.ImageCollection(
            "projects/sat-io/open-datasets/landcover/ESRI_Global-LULC_10m_TS"
        ).filter(ee.Filter.date("2019-01-01", "2020-01-01")).filterBounds(aoi).mosaic().clip(aoi);
esri_lulc = esri_lulc.eq(5).rename('crop')
var esriDisp = Map.addLayer(esri_lulc.selfMask(), classVis, 'Cropland from esri-lulc');
esriDisp.setShown(0)

var ensemble = ee.ImageCollection.fromImages([glad, worldcover_v200, esri_lulc]).mode()
var ensembleDisp = Map.addLayer(ensemble.selfMask(), classVis, 'Cropland from ensemble');
ensembleDisp.setShown(0)

// Classification -> Map
var trainedRf = ee.Classifier.smileRandomForest({numberOfTrees: 20})
  .setOutputMode('probability')
  .train({
    features: training, classProperty: 'is_crop', inputProperties: bands
});

// focalMode?
var classifiedRf = image.select(bands).classify(trainedRf).clip(aoi);
var classVis = {min: 0, max: 1.0, palette: palettes.cmocean.Speed[7].slice(0,-2)}
var cropProb = Map.addLayer(classifiedRf, classVis, 'Cropland Probability');
cropProb.setShown(0)
var classVis = {min: 0, max: 1.0, palette: ['000000', 'green'], opacity: 0.8}
Map.addLayer(classifiedRf.gt(0.5).selfMask(), classVis, 'Cropland Binary');

var explained = trainedRf.explain();
print('Explain:', explained);

var ndvi = image.select(".*_NDVI").rename(daterange)

// Create the title label.
var title = ui.Label('Click to inspect');
title.style().set('position', 'top-center');
Map.add(title);
var panel = ui.Panel();
panel.style().set({width: '400px', position: 'bottom-right'});
Map.add(panel);
Map.style().set('cursor', 'crosshair');
Map.onClick(function(coords) {
  panel.clear();
  console.log(coords.lat + ',' + coords.lon)
  var point = ee.Geometry.Point(coords.lon, coords.lat);
  var chart = ui.Chart.image.regions(ndvi, point, null, 10);
  chart.setOptions({title: 'NDVI'});
  panel.add(chart);
});

var empty = ee.Image().byte();
var outline = empty.paint({featureCollection: border, color: 1, width: 2});
Map.addLayer(outline, {}, 'Region Borders');

Export.image.toAsset({
  image: classifiedRf,
  description: 'Senegal/2022_cropmask_v1',
  assetId: 'Senegal/2022_cropmask_v1',
  region: aoi,
  scale: 10,
  maxPixels: 1e12,
  crs: 'EPSG:4326'
});
